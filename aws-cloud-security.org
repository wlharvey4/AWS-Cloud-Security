# -*- mode:org; fill-column:99; -*-

#+title:AWS: Getting Started with Cloud Security
#+subtitle:edX AWS:OTP-AWSD7 {{{version}}} ({{{date}}})
#+date:2019-10-15T20:05
#+author:edX
#+macro:version Version 0.0.5

Let AWS Solutions Architects start you on your journey to secure your cloud resources.

This course will focus on what you need to know to develop and use best security practices when
using, building your applications on AWS.

[[file:resources/images/course_logo.png]]

* About the Course
:PROPERTIES:
:unnumbered: t
:END:

Data security is on the forefront of everyone’s mind these days, with data breaches, denial of
service attacks, ransomware and malware being common news stories.

In this course two of Amazon Web Services’ Solutions Architects will provide you with a
foundational understanding of cloud security, compliance and the AWS shared responsibility
model. They will then discuss more technical content by looking at various security controls such
as identity and access management services, directory services, network isolation and connectivity
options, auditing, monitoring, encryption and managing secrets.

This course will cover a number of AWS services, such as Amazon VPC, Amazon CloudWatch, AWS
CloudTrail, Amazon GuardDuty, AWS Security Hub, Amazon S3, Amazon EBS, Amazon EC2, and AWS Secrets
Manager, among others.

Several demonstrations are provided throughout the course to provide a practical example of the
concepts that have been discussed. Class discussions will provide an opportunity for you to
interact with fellow students as well as AWS training staff.

- Length :: 4 weeks
- Effort :: 2–4 hours per week
- Institution :: AWS
- Level :: Introductory

** What You Will Learn
- How the AWS Shared Responsibility Model is used to differentiate between security of the cloud
  and security in the cloud
- How to use network isolation to protect cloud resources
- How to audit and monitor applications using services such as Amazon CloudWatch, Amazon GuardDuty
  and AWS Security Hub
- The difference between encryption of data at rest and data in transit
- How to protect compute resources
- How to manage secrets

** The Instructors
{{{heading(Rudy Chetty)}}}

{{{subheading(Senior Solutions Architect)}}}

Rudy has been with Amazon Web Services for more than 2 years. He is a Solutions Architect and works
across segments like robotics, fulfillment and last mile.  He is originally from Cape Town, South
Africa and is a big fan of education.

{{{heading(Hong Pham)}}}

{{{subheading(Solutions Architect)}}}

Hong has been with Amazon Web Services for more than 4 years, and is currently a Solutions
Architect. She was born in Vietnam and moved to the US ten years ago. She attended the University
of Utah where she studied marketing and information systems.

* 1. Introduction to Cloud Security
Week 1 is all about the basics. 

** Introduction to AWS Cloud Security
- Fundamentals of cloud security
  - shared responsibility security model
- Compliance in AWS
- Account managment
  - creating accounts
  - managing multiple accounts
  - securing account and api service calls

** The AWS Shared Responsibility Model
-  https://aws.amazon.com/compliance/shared-responsibility-model/

[[file:resources/images/shared_responsibility_model-50.png]]

#+cindex:security and compliance
#+cindex:shared responsibility
Security and Compliance is a /shared responsibility/ between AWS and the customer.  This shared
model can help relieve customer’s operational burden as AWS operates, manages and controls the
components from the host operating system and virtualization layer down to the physical security of
the facilities in which the service operates.

Amazon provides AWS Security Services, such as:
- AWS Identity and Access Management (IAM)
- Amazon Cognito


#+cindex:security group firewall
The customer assumes responsibility and management of:
- the guest operating system (including updates and security patches),
- other associated application software as well as
- the configuration of the AWS provided security group firewall.


{{{subheading(Responsibilities vary based upon chosen services)}}}

Customers should carefully consider the services they choose as their responsibilities vary
depending on the services used, the integration of those services into their IT environment, and
applicable laws and regulations.  The nature of this shared responsibility also provides the
flexibility and customer control that permits the deployment.

*** AWS Security Services---Responsibilities
#+cindex:shared responsibiltiy model

[[file:resources/images/shared_responsibility_model_v2-50.png]]

{{{subheading(Security “of” the Cloud)}}}
AWS is responsible for security “of the Cloud”:
- accounts
- networking
- access
- infrastructure


{{{subheading(Infrastructure)}}}

AWS is responsible for protecting the /infrastructure/ that runs all of the services offered in the
AWS Cloud.  This infrastructure is composed of:
  - the hardware,
  - software,
  - networking, and
  - facilities that run AWS Cloud services.


AWS is responsible for security “of the cloud”
- S3
- IoT Core
- Amazon SageMaker
- Amazon RDS


{{{subheading(Region Security)}}}

AWS is also responsible for securing the infrastructure of its regions.
- AWS global infrastructure
- Regions
- Availability zones
- Edge locations

- AWS Identity and Access Management (IAM)
- Amazon Cognito


*** AWS Customer Responsibilities

Customer responsibility will be determined by the AWS Cloud services that a customer selects.  This
determines the amount of configuration work the customer must perform as part of their security
responsibilities.

#+cindex:Elastic Compute Cloud EC2
#+cindex:EC2
#+cindex:Infrastructure as a Service Iaas
#+cindex:IaaS
#+cindex:security group, firewall
#+cindex:firewall, security group
For example, a service such as Amazon Elastic Compute Cloud (Amazon EC2) is categorized as
Infrastructure as a Service (IaaS) and, as such, requires the customer to perform all of the
necessary security configuration and management tasks.  Customers that deploy an Amazon EC2
instance are responsible for management of the guest operating system (including updates and
security patches), any application software or utilities installed by the customer on the
instances, and the configuration of the AWS-provided firewall (called a security group) on each
instance.

#+cindex:abstracted services
#+cindex:S3
#+cindex:DynamoDB
For abstracted services, such as Amazon S3 and Amazon DynamoDB, AWS operates the infrastructure
layer, the operating system, and platforms, and customers access the endpoints to store and
retrieve data.  Customers are responsible for managing their data (including encryption options),
classifying their assets, and using IAM tools to apply the appropriate permissions.

{{{subheading(Security “in” the Cloud)}}}

The customer is responsible for security “in the cloud”
- whatever you build must be secured by you
- home alarm system; AWS provides it, but you need to operate it

** AWS Compliance

Detailed information about AWS Compliance programs can be found here:
- https://aws.amazon.com/compliance/
- https://aws.amazon.com/compliance/data-center/


Two example compliance programs and standards that owners need to follow if their application fits
these requirements.

#+cindex:compliance
- PCI compliant (Payment Card Industry)
- FedRAMP compliant - Build a highly confidential system to store secrets


The application owner needs to maintain adequate governance over the entire IT controleld
environment.

{{{heading(Best Practices for Compliance)}}}

1. Understand compliance objectives and requirements
2. Establish a contolled environment that meets those objectives and requirements
3. Understand the validation requirement based on organization’s risk tolerance
4. Need verification of the operating effectivenes of the controlled environment


{{{heading(Shared Responsibility for Compliance)}}}

It is a shared responsibility model between the application owner and AWS.  AWS’s part in this
shared responsibility includes providing its services on a highly secure and controlled platform;
and providing a wide array of security features that the owner can use.

The owner’s responsibility includes configuring the IT environment in a secure and controlled
manner for its purposes.  AWS communicates its security and control information to customers.  The
owner can check if a specific AWS service is compliant with specific programs by visiting the [[https://aws.amazon.com/compliance/services-in-scope/][AWS
Services in Scope portal]].

{{{heading(AWS Services in Scope)}}}

#+cindex:scope of compliance efforts
#+begin_quote
We include services in the scope of our compliance efforts based on the expected use case, feedback
and demand.  If a service is not currently listed as in scope of the most recent assessment, it
does not mean that you cannot use the service.  It is part of the shared responsibility for your
organization to determine the nature of the data.  Based on the nature of what you are building on
AWS, you should determine if the service will process or store customer data and how it will or
will not impact the compliance of your customer data environment.
#+end_quote

*** Best Practices
- Understand compliance objectives and requirements
- Establish controlled environment that meets objectives and requirements
- Understand validation required based on your organization’s risk tolerance
- Verification of operating effectiveness of controlled environment
** The AWS Account
An owner needs an AWS account.  This allows the owner to access the console and to provision other
users, which opens up other channels of interaction, such as:
- CLI command-line interface
- programmatic access
- API calls
- use SDKs to interact with the AWS account


{{{heading(Principle of Least Privilege)}}}

Upon first creating an account, you will be interacting with the super user, or root user,
account.  As the super user, the owner can do anything and everything, including causing
irreparable harm, such as deleting resources that should not have been deleted.  It is therefore a
/best practice/ to create individual user accounts for each user (including the owner) and provide
them with relevant access according to the /Principle of Least Privilege/.  This means that an
owner should provision the minimum needed access policies so users can perform the work they need,
but no more.

{{{heading(Adding New Users)}}}

You can create users via the IAM console by choosing a user name and password and defining how they
can access AWS (via the console or programmatically), and then adding policies that stipulate the
resources they can access.

For example, to create a new admin user, you attach the “administrator access policy”, which is a
JSON document that describes the policy.

{{{heading(Multifactor Authentication)}}}

An additional layer of protection can be added to new users as well: MFA, or “Mutlifactor
Authentication.”  This should also be enabled for the super user account.  Upon seeking to log in,
the user will be queried for an additional code to enter, which can come from a variety of sources,
such as:
- Google Authenticator, a code
- YubiKey, a security key
- Gemalto Token, a token device


Other best practices include:

- using strong passwords
- using roles and groups to assign permissions
- monitoring using CloudWatch and CloudTrail

** Multiple Accounts
This section discusses how to handle a growing number of users, teams, organizations, and
accounts.  For example, let’s say you have two AWS accounts, one for storing data in S3, called
“DataAccount”, and one for developers to build applications, called “DevAccount”.

For more information about IAM users and groups, see
- [[https://docs.aws.amazon.com/IAM/latest/UserGuide/id.html][Identities (Users, Groups, and Roles)]]

*** IAM Roles
You can delegate access across AWS accounts using IAM /roles/.  You have multiple IT engineers who
are tasked to manage AWS accounts and resources.  As an IT manager, you need to grant AWS admin
access for your engineers.  You can create an IAM group for admin users and assign IAM users to the
group.

1. From the IAM Console, create a new group, and name it “AdminGroup”.

2. Associate an IAM policy with the new group.  Because the group is for admin users, search for
   the “AdministratorAccess” IAM policy.

3. Create the group.

4. Create an IAM user who will be made a member of the group.  Give the user a name, such as
   “Admin_IT_Joe”.  Give the user appropriate access, such as programmatic access and management
   console access.  Also take care of password creation.

5. Associate permissions with the new user.  There are three options to create permissions for a
   user:

   i. add the user to an IAM group;

   ii. copy permissions from another user;

   iii. attach existing policies directly to the user.

6. In this case, add the user to the group that was created, “AdminGroup”.

7. Consider adding tags to the user, such as =Department::IT”

8. Create the user and download or email the configuration information for the new user.

*** AWS Organizations
How do you scale and automate AWS account creations?  How do you make sure each team and
organization has the appropriate permissions to use the appropriate AWS services and resources?
How to roll all AWS bills into one master account?  Utilize AWS Organizations.

For more information on AWS Organizations, see:
- https://aws.amazon.com/organizations/
- [[https://console.aws.amazon.com/organizations/home?#/getting-started][Tutorial on getting started with AWS Organizations]]


Using AWS Organizations, you can:

- centrally govern your environment as you grow and scale;
- automate account creation and management;
- create groups of accounts to reflect business needs;
- govern access to AWS services and resources by Region by policies;
- set up a single payment method for all AWS accounts with consoldated billing;
- share resources across accounts


1. Choose an AWS account as a master account;

2. Create an organization in this master account;

3. When you use organizations to create a new account, an IAM role will be created so that the
   master account can switch roles to access your member account;

4. Either create an organizational unit (OU), or accounts (member accounts), under the
   organization.

5. Create service control policies to OU or member accounts;


{{{heading(Best Practices for Organizations)}}}

1. Plan ahead for the structure of your organization;

2. Keep the master account free of any operational AWS resources;

3. Use CloudTrail in the master account to centrally track all AWS usage in the member accounts;

4. Apply the principle of least privilege; when setting up policies for OUs, assign as few
   privileges as possible;

5. Assign policies to to OUs rather than accounts;

6. Test new and modified policies on a single account before scaling up to organizational units;

7. Use the APIs and AWS CloudFormation templates to ensure that every newly created account is
   configured properly.  The template can create IAM user roles and policies; it can also set up
   logging, create and configure VPCs, and so forth.

*** Tutorial on Cross-Account Access Delegation Using Roles
- [[https://docs.aws.amazon.com/IAM/latest/UserGuide/tutorial_cross-account-with-roles.html][Delegate Access Across AWS Accounts Using IAM Roles]]


This tutorial teaches you how to use a /role/ to delegate access to resources that are in different
AWS accounts that you own (Production and Development).  You /share resources/ in one account with
users in a different account.  By setting up /cross-account access/ in this way, you don't need to
create individual IAM users in each account.  In addition, users don't have to sign out of one
account and sign into another in order to access resources in different AWS accounts.  After
configuring the role, you see how to use the role from the AWS Management Console, the AWS CLI, and
the API.

{{{heading(Scenario)}}}

In this tutorial, imagine that the *Production* account is where live applications are managed.
The *Development* account is a sandbox where developers and testers can freely test applications.
In each account, application information is stored in *Amazon S3 buckets*.

You manage *IAM users* in the Development account, where you have two *IAM groups*: *Developers*
and *Testers*.  Users in both groups have permissions to work in the Development account and access
resources there.

From time to time, a developer must update the live applications in the Production account.  These
applications are stored in an Amazon S3 bucket called =productionapp=.

At the end of this tutorial, you have the following:

- /Users/ in the Development account (the trusted account) that are allowed to assume a specific role
  in the Production account.

- A /role/ in the Production account (the trusting account) that is allowed to access a specific
  Amazon S3 bucket.

- The =productionapp= bucket in the Production account.


Developers can use the *role* in the /AWS Management Console/ to access the =productionapp= bucket
in the Production account.  They can also access the bucket by using /API calls/ that are
authenticated by *temporary credentials* provided by the role.  Similar attempts by a Tester to use
the role fail.

This workflow has three basic steps (see [[tutorial-cross-accounts-png][diagram]]).

#+caption:Three basic steps in the workflow
#+name:tutorial-cross-accounts-png
[[file:./images/tutorial-cross-accounts.png]]

{{{heading(Prerequisites)}}}

This tutorial assumes that you have the following already in place:

- Two separate AWS accounts that you can use, one to represent the *Development* account, and one to
  represent the *Production* account.

- *Users* and *groups* in the Development account created and configured as follows:


| User    | Group      | Permissions                                                                                   |
|---------+------------+-----------------------------------------------------------------------------------------------|
| David   | Developers | Both users are able to sign in and use the AWS Management Console in the Development account. |
| Theresa | Testers    |                                                                                               |

**** Step 1---Create a Role
First, you use the AWS Management Console to establish trust between the Production account (ID
number 999999999999) and the Development account (ID number 111111111111).  You start by creating
an *IAM role* named “UpdateApp”.  When you create the role, you define the Development account as a
/trusted entity/ and specify a /permissions policy/ that allows trusted users to update the
=productionapp= bucket.

**** Step 2---Grant access to the Role
In this step of the tutorial, you modify the *IAM group policy* so that Testers are denied access
to the “UpdateApp” role.  Because Testers have PowerUser access in this scenario, we must explicitly
deny the ability to use the role.

**** Step 3---Test access by switching Roles
Finally, as a Developer, you use the “UpdateApp” role to update the =productionapp= bucket in the
Production account.  You see how to access the role through the AWS console, the AWS CLI, and the
API.

** Identity & Access Services---Part 1

** Identity & Access Services---Part 2

* 2. Securing the Infrastructure

** Introduction to Networks

** Network Isolation

** Network Isolation with VPC

** VPC Endpoint and Private Link

** Detective Controls

** Auditing

** Monitoring CloudWatch and CloudWatch Logs

** Monitoring Guard Duty and Security Hub

** Demo---AWS Config

* 3. Data Protection

** Introduction to Data

** Data Types

** Encryption in Transit

** Encryption at Rest

** Databse Encryption

** Amazon S3

** EBS Encryption

** Demo---Cross Acount Access to S3

* 4. Securing the Application

** Introduction to Compute Resources

** Protecting Compute Resources

** Protecting the Endpoint

** Managing Secrets

** Demo---AWS Secrets Manager

** The Well-Architected Tool

* Concept Index
:PROPERTIES:
:index:    cp
:unnumbered: t
:END:
* Macro Definitions                                                :noexport:
#+macro:heading @@texinfo:@heading $1@@@@latex:\section* {$1}@@
#+macro:subheading @@texinfo:@subheading $1@@@@latex:\subsection* {$1}@@
* Local Variables                                                  :noexport:
# Local Variables:
# time-stamp-pattern:"8/^\\#\\+date:%4:y-%02m-%02dT%02H:%02M$"
# eval: (electric-quote-local-mode)
# eval: (org-indent-mode)
# End:
